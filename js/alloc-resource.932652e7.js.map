{"version":3,"file":"js/alloc-resource.932652e7.js","mappings":"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","sources":["webpack://edu-fed/./src/views/role/alloc-resource.vue","webpack://edu-fed/src/views/role/alloc-resource.vue","webpack://edu-fed/./src/views/role/alloc-resource.vue?2a4c","webpack://edu-fed/./src/views/role/alloc-resource.vue?593b","webpack://edu-fed/./src/service/resource.js"],"sourcesContent":["var render = function render(){var _vm=this,_c=_vm._self._c;return _c('div',{staticClass:\"alloc-resource\"},[_c('el-card',[_vm._l((_vm.categoryList),function(item){return _c('div',{key:item.id,staticStyle:{\"border-top\":\"1px solid #dcdfe6\"}},[_c('el-row',{staticStyle:{\"background-color\":\"rgb(242, 246, 252)\"}},[_c('el-checkbox',{attrs:{\"indeterminate\":_vm.isIndeterminate},on:{\"change\":_vm.handleCheckAllChange},model:{value:(_vm.checkAll),callback:function ($$v) {_vm.checkAll=$$v},expression:\"checkAll\"}},[_vm._v(_vm._s(item.name))])],1),_c('el-row',[_c('el-checkbox-group',{on:{\"change\":_vm.handleCheckedKeysChange},model:{value:(_vm.checkedKeys),callback:function ($$v) {_vm.checkedKeys=$$v},expression:\"checkedKeys\"}},_vm._l((_vm.cateSource(item.id)),function(source){return _c('el-checkbox',{key:source.id,staticStyle:{\"width\":\"30%\"},attrs:{\"label\":source.id}},[_vm._v(\" \"+_vm._s(source.name)+\" \")])}),1)],1)],1)}),_c('div',{staticClass:\"btn\"},[_c('el-button',{attrs:{\"type\":\"primary\"},on:{\"click\":_vm.onSave}},[_vm._v(\"保存\")]),_c('el-button',{on:{\"click\":_vm.onReset}},[_vm._v(\"清空\")])],1)],2)],1)\n}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","<template>\r\n  <div class=\"alloc-resource\">\r\n    <el-card>\r\n      <div style=\"border-top: 1px solid #dcdfe6;\" v-for=\"item in categoryList\" :key=\"item.id\">\r\n        <el-row style=\"background-color: rgb(242, 246, 252);\">\r\n          <el-checkbox :indeterminate=\"isIndeterminate\" v-model=\"checkAll\" @change=\"handleCheckAllChange\">{{ item.name }}</el-checkbox>\r\n        </el-row>\r\n        <el-row>\r\n          <el-checkbox-group v-model=\"checkedKeys\" @change=\"handleCheckedKeysChange\">\r\n            <!-- <el-col :span=\"8\"> -->\r\n            <el-checkbox v-for=\"source in cateSource(item.id)\" :label=\"source.id\" :key=\"source.id\" style=\"width:30%\">\r\n                {{source.name}}\r\n            </el-checkbox>\r\n            <!-- </el-col> -->\r\n          </el-checkbox-group>\r\n        </el-row>\r\n      </div>\r\n      <div class=\"btn\">\r\n        <el-button type=\"primary\" @click=\"onSave\">保存</el-button>\r\n        <el-button @click=\"onReset\">清空</el-button>\r\n      </div>\r\n    </el-card>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport { getAllResource, getResourceCategories, getRoleSource, allocRoleSource } from '@/service/resource'\r\n\r\nexport default {\r\n  name: 'AllocResource',\r\n  props: {\r\n    roleId: {\r\n      type: [Number, String],\r\n      required: true\r\n    }\r\n  },\r\n  data () {\r\n    return {\r\n      checkAll: false,\r\n      sourceList: [],\r\n      categoryList: [],\r\n      // roleResource: [],\r\n      checkedKeys: [],\r\n      isIndeterminate: true\r\n    }\r\n  },\r\n  created () {\r\n    this.loadAllResource()\r\n    this.loadResourceCategory()\r\n    this.loadRoleResource()\r\n  },\r\n  methods: {\r\n    cateSource (categryId) {\r\n      let arr = []\r\n      this.sourceList.forEach(source => {\r\n        if (source.categoryId === categryId) {\r\n          arr = [...arr, source]\r\n        }\r\n      })\r\n      return arr\r\n    },\r\n    handleCheckAllChange (val) {\r\n      // console.log(val)\r\n      this.checkedKeys = val ? this.sourceList : []\r\n      this.isIndeterminate = false\r\n    },\r\n    handleCheckedKeysChange (value) {\r\n      console.log(value)\r\n      this.checkedKeys = value\r\n      const checkedCount = value.length\r\n      this.checkAll = checkedCount === this.sourceList.length\r\n      this.isIndeterminate = checkedCount > 0 && checkedCount < this.sourceList.length\r\n    },\r\n    getCheckedKeys (resources) {\r\n      // 遍历数据 将所有存在子节点的 node 排除 对子节点列表进行筛选\r\n      resources.forEach(resource => {\r\n        if (!resource.selected) {\r\n          return\r\n        }\r\n        // 检测是否存在子节点\r\n        if (resource.resourceList) {\r\n          // 对子节点进行选中状态检测\r\n          return this.getCheckedKeys(resource.resourceList)\r\n        }\r\n        // 说明选中的是叶子节点 并存储 ID\r\n        this.checkedKeys = [...this.checkedKeys, resource.id]\r\n      })\r\n    },\r\n    async loadAllResource () {\r\n      const { data } = await getAllResource()\r\n      if (data.code === '000000') {\r\n        this.sourceList = data.data\r\n      }\r\n    },\r\n    async loadResourceCategory () {\r\n      const { data } = await getResourceCategories()\r\n      if (data.code === '000000') {\r\n        this.categoryList = data.data\r\n      }\r\n    },\r\n    async loadRoleResource () {\r\n      const { data } = await getRoleSource(this.roleId)\r\n      if (data.code === '000000') {\r\n        // this.roleResource = data.data\r\n        this.getCheckedKeys(data.data)\r\n      }\r\n    },\r\n    async onSave () {\r\n      const { data } = await allocRoleSource({\r\n        roleId: this.roleId,\r\n        resourceIdList: this.checkedKeys\r\n      })\r\n      if (data.code === '000000') {\r\n        this.$message.success('保存成功！')\r\n        this.$router.push({ name: 'role' })\r\n      }\r\n    },\r\n    onReset () {\r\n      this.checkedKeys = []\r\n      this.isIndeterminate = false\r\n    }\r\n  }\r\n}\r\n</script>\r\n\r\n<style lang=\"scss\" scoped>\r\n  .el-row {\r\n    padding: 20px;\r\n    border-left: 1px solid #dcdfe6;\r\n    border-right: 1px solid #dcdfe6;\r\n    border-bottom: 1px solid #dcdfe6;\r\n  }\r\n  .el-col {\r\n    padding: 4px 0;\r\n  }\r\n  .btn {\r\n    text-align: center;\r\n    margin-top: 20px;\r\n  }\r\n</style>\r\n","import mod from \"-!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js??clonedRuleSet-40.use[1]!../../../node_modules/@vue/vue-loader-v15/lib/index.js??vue-loader-options!./alloc-resource.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js??clonedRuleSet-40.use[1]!../../../node_modules/@vue/vue-loader-v15/lib/index.js??vue-loader-options!./alloc-resource.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./alloc-resource.vue?vue&type=template&id=d1c24dbe&scoped=true&\"\nimport script from \"./alloc-resource.vue?vue&type=script&lang=js&\"\nexport * from \"./alloc-resource.vue?vue&type=script&lang=js&\"\nimport style0 from \"./alloc-resource.vue?vue&type=style&index=0&id=d1c24dbe&prod&lang=scss&scoped=true&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../node_modules/@vue/vue-loader-v15/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"d1c24dbe\",\n  null\n  \n)\n\nexport default component.exports","import request from '@/utils/request'\r\n\r\n// 获取所有资源\r\nexport const getAllResource = () => request({ method: 'GET', url: '/boss/resource/getAll' })\r\n\r\n// 按条件分页查询资源接口\r\nexport const getResourcePages = (data) => request({ method: 'POST', url: '/boss/resource/getResourcePages', data })\r\n\r\n// 查询资源分类列表接口\r\nexport const getResourceCategories = () => request({ method: 'GET', url: '/boss/resource/category/getAll' })\r\n\r\n// 保存或更新资源接口\r\nexport const addOrUpdateResource = (data) => request({ method: 'POST', url: '/boss/resource/saveOrUpdate', data })\r\n\r\n// 删除资源\r\nexport const deleteResource = (id) => request({ method: 'DELETE', url: `/boss/resource/${id}` })\r\n\r\n// 查询资源分配列表\r\nexport const getAllCategory = () => request({ method: 'GET', url: '/boss/resource/category/getAll' })\r\n\r\n// 保存或更新资源分类\r\nexport const saveOrUpdateCategory = (data) => request({ method: 'POST', url: '/boss/resource/category/saveOrderUpdate', data })\r\n\r\n// 删除资源分类\r\nexport const deleteCategory = (id) => request({ method: 'DELETE', url: `/boss/resource/category/${id}` })\r\n\r\n// 获取角色拥有的资源列表\r\nexport const getRoleSource = (roleId) => request({ method: 'GET', url: `/boss/resource/getRoleResources?roleId=${roleId}` })\r\n\r\n// 给角色分配资源\r\nexport const allocRoleSource = (data) => request({ method: 'POST', url: '/boss/resource/allocateRoleResources', data })\r\n"],"names":["render","_vm","this","_c","_self","staticClass","_l","categoryList","item","key","id","staticStyle","attrs","isIndeterminate","on","handleCheckAllChange","model","value","checkAll","callback","$$v","expression","_v","_s","name","handleCheckedKeysChange","checkedKeys","cateSource","source","onSave","onReset","staticRenderFns","props","roleId","type","required","data","sourceList","created","methods","arr","console","getCheckedKeys","resources","resourceIdList","component","getAllResource","request","method","url","getResourcePages","getResourceCategories","addOrUpdateResource","deleteResource","getAllCategory","saveOrUpdateCategory","deleteCategory","getRoleSource","allocRoleSource"],"sourceRoot":""}