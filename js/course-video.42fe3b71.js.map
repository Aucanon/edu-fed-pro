{"version":3,"file":"js/course-video.42fe3b71.js","mappings":"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","sources":["webpack://edu-fed/./src/views/course/video.vue","webpack://edu-fed/./src/service/aliyun-upload.js","webpack://edu-fed/src/views/course/video.vue","webpack://edu-fed/./src/views/course/video.vue?4188","webpack://edu-fed/./src/views/course/video.vue?c1cc"],"sourcesContent":["var render = function render(){var _vm=this,_c=_vm._self._c;return _c('div',{staticClass:\"course-video\"},[_c('el-card',[_c('div',{attrs:{\"slot\":\"header\"},slot:\"header\"},[_vm._v(\" 课程相关信息 \")]),_c('el-form',{attrs:{\"label-position\":\"right\",\"label-width\":\"80px\"}},[_c('el-form-item',{attrs:{\"label\":\"课程内容\"}},[_c('el-input',{attrs:{\"value\":this.$route.query.theme,\"disabled\":\"\"}})],1),_c('el-form-item',{attrs:{\"label\":\"课时\"}},[_c('el-input',{attrs:{\"value\":this.$route.query.duration,\"disabled\":\"\"}})],1),_c('el-form-item',{attrs:{\"label\":\"视频上传\"}},[_c('input',{ref:\"video-file\",attrs:{\"type\":\"file\"}})]),_c('el-form-item',{attrs:{\"label\":\"封面上传\"}},[_c('input',{ref:\"image-file\",attrs:{\"type\":\"file\"}})]),_c('el-form-item',[_c('el-button',{on:{\"click\":_vm.handleUpload}},[_vm._v(\" 开始上传\")]),_c('el-button',{on:{\"click\":function($event){return _vm.$router.push({\n          name: 'course-section',\n          params: {\n            courseId: _vm.courseId\n          }\n        })}}},[_vm._v(\" 返回\")])],1),_c('el-form-item',[(_vm.uploadPercent !== 0)?_c('p',[_vm._v(\"视频上传中：\"+_vm._s(_vm.uploadPercent)+\"%\")]):_vm._e(),(_vm.isUploadSuccess)?_c('p',[_vm._v(\"视频\"+_vm._s(_vm.isTranscodeSuccess ? '转码完成' : '正在转码中...'))]):_vm._e()])],1)],1)],1)\n}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","import request from '@/utils/request'\r\n\r\n// 获取阿里云图片上传凭证\r\nexport const aliyunImagUploadAddressAndnAuth = () => request({ method: 'GET', url: '/boss/course/upload/aliyunImagUploadAddressAdnAuth.json' })\r\n\r\n// 获取阿里云视频上传凭证\r\nexport const aliyunVideoUploadAddressAndnAuth = (params) => request({ method: 'GET', url: '/boss/course/upload/aliyunVideoUploadAddressAdnAuth.json', params })\r\n\r\n// 阿里云转码请求\r\nexport const aliyunTranscode = (data) => request({ method: 'POST', url: '/boss/course/upload/aliyunTransCode.json', data })\r\n\r\n// 阿里云转码进度\r\nexport const aliyunTransCodePercent = (lessonId) => request({ method: 'GET', url: `/boss/course/upload/aliyunTransCodePercent.json?lessonId=${lessonId}` })\r\n","<template>\r\n  <div class=\"course-video\">\r\n    <el-card>\r\n      <div slot=\"header\">\r\n        课程相关信息\r\n      </div>\r\n      <el-form label-position=\"right\" label-width=\"80px\">\r\n        <el-form-item label=\"课程内容\">\r\n          <el-input :value=\"this.$route.query.theme\" disabled></el-input>\r\n        </el-form-item>\r\n        <el-form-item label=\"课时\">\r\n          <el-input :value=\"this.$route.query.duration\" disabled></el-input>\r\n        </el-form-item>\r\n        <el-form-item label=\"视频上传\">\r\n          <input type=\"file\" ref=\"video-file\">\r\n        </el-form-item>\r\n        <el-form-item label=\"封面上传\">\r\n          <input type=\"file\" ref=\"image-file\">\r\n        </el-form-item>\r\n        <el-form-item>\r\n          <el-button\r\n          @click=\"handleUpload\">\r\n          开始上传</el-button>\r\n          <el-button\r\n          @click=\"$router.push({\r\n            name: 'course-section',\r\n            params: {\r\n              courseId\r\n            }\r\n          })\">\r\n          返回</el-button>\r\n        </el-form-item>\r\n        <el-form-item>\r\n          <p v-if=\"uploadPercent !== 0\">视频上传中：{{ uploadPercent }}%</p>\r\n          <p v-if=\"isUploadSuccess\">视频{{ isTranscodeSuccess ? '转码完成' : '正在转码中...' }}</p>\r\n        </el-form-item>\r\n      </el-form>\r\n    </el-card>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\n/* eslint-disable */\r\nimport { aliyunImagUploadAddressAndnAuth, aliyunVideoUploadAddressAndnAuth, aliyunTranscode, aliyunTransCodePercent } from '@/service/aliyun-upload'\r\n\r\nexport default {\r\n  name: 'CourseVideo',\r\n  props: {\r\n    courseId: {\r\n      type: [String, Number],\r\n      require: true\r\n    },\r\n    lessonId: {\r\n      type: [Number, String],\r\n      require: true\r\n    }\r\n  },\r\n  data () {\r\n    return {\r\n      imageUrl: '',\r\n      uploader: null,\r\n      videoId: null,\r\n      uploadPercent: 0,\r\n      isUploadSuccess: false,\r\n      isTranscodeSuccess: false\r\n    }\r\n  },\r\n  created () {\r\n    this.initUploader()\r\n  },\r\n  methods: {\r\n    initUploader () {\r\n      this.uploader = new AliyunUpload.Vod({\r\n        // userID，必填，您可以使用阿里云账号访问账号中心（https://account.console.aliyun.com/），即可查看账号ID\r\n        userId: '1618139964448548',\r\n        // 上传到视频点播的地域，默认值为'cn-shanghai'，\r\n        // eu-central-1，ap-southeast-1\r\n        region: '',\r\n        // 分片大小默认1 MB，不能小于100 KB（100*1024）\r\n        partSize: 1048576,\r\n        // 并行上传分片个数，默认5\r\n        parallel: 5,\r\n        // 网络原因失败时，重新上传次数，默认为3\r\n        retryCount: 3,\r\n        // 网络原因失败时，重新上传间隔时间，默认为2秒\r\n        retryDuration: 2,\r\n        // 开始上传\r\n        onUploadstarted: async (uploadInfo) => {\r\n          let uploadAdressAndAuth = null\r\n          if (uploadInfo.isImage) {\r\n            const { data } = await aliyunImagUploadAddressAndnAuth()\r\n            if (data.code === '000000') {\r\n              uploadAdressAndAuth = data.data\r\n              this.imageUrl = uploadAdressAndAuth.imageUrl\r\n            }\r\n          } else {\r\n            const { data } = await aliyunVideoUploadAddressAndnAuth({\r\n              fileName: uploadInfo.file.name,\r\n              imageUrl: this.imageUrl\r\n            })\r\n            if (data.code === '000000') {\r\n              uploadAdressAndAuth = data.data\r\n              this.videoId = data.data.videoId\r\n            }\r\n          }\r\n          this.uploader.setUploadAuthAndAddress(\r\n            uploadInfo,\r\n            uploadAdressAndAuth.uploadAuth,\r\n            uploadAdressAndAuth.uploadAddress,\r\n            uploadAdressAndAuth.imageId || uploadAdressAndAuth.videoId\r\n          )\r\n        },\r\n        // 文件上传成功\r\n        onUploadSucceed: function (uploadInfo) {\r\n        },\r\n        // 文件上传失败\r\n        onUploadFailed: function (uploadInfo, code, message) {\r\n        },\r\n        // 文件上传进度，单位：字节\r\n        onUploadProgress: (uploadInfo, totalSize, loadedPercent) => {\r\n          if (!uploadInfo.image) {\r\n            this.uploadPercent = Math.floor(loadedPercent * 100)\r\n          }\r\n        },\r\n        // 上传凭证或STS token超时\r\n        onUploadTokenExpired: function (uploadInfo) {\r\n        },\r\n        // 全部文件上传结束\r\n        onUploadEnd: async (uploadInfo) => {\r\n          this.isUploadSuccess = true\r\n          const { data } = await aliyunTranscode({\r\n            lessonId: this.lessonId,\r\n            coverImageUrl: this.imageUrl,\r\n            fileId: this.videoId,\r\n            fileName: this.$refs['video-file'].files[0].name\r\n          })\r\n          if (data.code === '000000') {\r\n            const timer = setInterval(async () => {\r\n              const { data } = await aliyunTransCodePercent(this.lessonId)\r\n              if (data.code === '000000') {\r\n                if (data.data === 100) {\r\n                  this.isTranscodeSuccess = true\r\n                  this.$message.success('视频转码成功！')\r\n                  clearInterval(timer)\r\n                }\r\n              }\r\n            }, 1000)\r\n          }\r\n        }\r\n      })\r\n    },\r\n    handleUpload () {\r\n      this.uploadPercent = 0\r\n      this.isTranscodeSuccess = false\r\n      this.isUploadSuccess = false\r\n      const videoFile = this.$refs['video-file'].files[0]\r\n      const imageFile = this.$refs['image-file'].files[0]\r\n      this.uploader.addFile(imageFile)\r\n      this.uploader.addFile(videoFile)\r\n      this.uploader.startUpload()\r\n    }\r\n  }\r\n}\r\n</script>\r\n\r\n<style lang=\"scss\" scoped>\r\n\r\n</style>\r\n","import mod from \"-!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js??clonedRuleSet-40.use[1]!../../../node_modules/@vue/vue-loader-v15/lib/index.js??vue-loader-options!./video.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js??clonedRuleSet-40.use[1]!../../../node_modules/@vue/vue-loader-v15/lib/index.js??vue-loader-options!./video.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./video.vue?vue&type=template&id=45df6428&scoped=true&\"\nimport script from \"./video.vue?vue&type=script&lang=js&\"\nexport * from \"./video.vue?vue&type=script&lang=js&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../node_modules/@vue/vue-loader-v15/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"45df6428\",\n  null\n  \n)\n\nexport default component.exports"],"names":["render","_vm","this","_c","_self","staticClass","attrs","slot","_v","$route","query","theme","duration","ref","on","handleUpload","$event","$router","push","name","params","courseId","uploadPercent","_s","_e","isUploadSuccess","isTranscodeSuccess","staticRenderFns","aliyunImagUploadAddressAndnAuth","request","method","url","aliyunVideoUploadAddressAndnAuth","aliyunTranscode","data","aliyunTransCodePercent","lessonId","props","type","require","imageUrl","uploader","videoId","created","methods","initUploader","userId","region","partSize","parallel","retryCount","retryDuration","onUploadstarted","uploadAdressAndAuth","fileName","uploadInfo","onUploadSucceed","onUploadFailed","onUploadProgress","onUploadTokenExpired","onUploadEnd","coverImageUrl","fileId","clearInterval","component"],"sourceRoot":""}