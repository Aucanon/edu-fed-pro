"use strict";(self["webpackChunkedu_fed"]=self["webpackChunkedu_fed"]||[]).push([[190],{5870:function(e,s,a){a.r(s),a.d(s,{default:function(){return f}});a(7658);var t=function(){var e=this,s=e._self._c;return s("div",{staticClass:"course-video"},[s("el-card",[s("div",{attrs:{slot:"header"},slot:"header"},[e._v(" 课程相关信息 ")]),s("el-form",{attrs:{"label-position":"right","label-width":"80px"}},[s("el-form-item",{attrs:{label:"课程内容"}},[s("el-input",{attrs:{value:this.$route.query.theme,disabled:""}})],1),s("el-form-item",{attrs:{label:"课时"}},[s("el-input",{attrs:{value:this.$route.query.duration,disabled:""}})],1),s("el-form-item",{attrs:{label:"视频上传"}},[s("input",{ref:"video-file",attrs:{type:"file"}})]),s("el-form-item",{attrs:{label:"封面上传"}},[s("input",{ref:"image-file",attrs:{type:"file"}})]),s("el-form-item",[s("el-button",{on:{click:e.handleUpload}},[e._v(" 开始上传")]),s("el-button",{on:{click:function(s){return e.$router.push({name:"course-section",params:{courseId:e.courseId}})}}},[e._v(" 返回")])],1),s("el-form-item",[0!==e.uploadPercent?s("p",[e._v("视频上传中："+e._s(e.uploadPercent)+"%")]):e._e(),e.isUploadSuccess?s("p",[e._v("视频"+e._s(e.isTranscodeSuccess?"转码完成":"正在转码中..."))]):e._e()])],1)],1)],1)},o=[],l=a(5286);const d=()=>(0,l.Z)({method:"GET",url:"/boss/course/upload/aliyunImagUploadAddressAdnAuth.json"}),i=e=>(0,l.Z)({method:"GET",url:"/boss/course/upload/aliyunVideoUploadAddressAdnAuth.json",params:e}),r=e=>(0,l.Z)({method:"POST",url:"/boss/course/upload/aliyunTransCode.json",data:e}),n=e=>(0,l.Z)({method:"GET",url:`/boss/course/upload/aliyunTransCodePercent.json?lessonId=${e}`});var u={name:"CourseVideo",props:{courseId:{type:[String,Number],require:!0},lessonId:{type:[Number,String],require:!0}},data(){return{imageUrl:"",uploader:null,videoId:null,uploadPercent:0,isUploadSuccess:!1,isTranscodeSuccess:!1}},created(){this.initUploader()},methods:{initUploader(){this.uploader=new AliyunUpload.Vod({userId:"1618139964448548",region:"",partSize:1048576,parallel:5,retryCount:3,retryDuration:2,onUploadstarted:async e=>{let s=null;if(e.isImage){const{data:e}=await d();"000000"===e.code&&(s=e.data,this.imageUrl=s.imageUrl)}else{const{data:a}=await i({fileName:e.file.name,imageUrl:this.imageUrl});"000000"===a.code&&(s=a.data,this.videoId=a.data.videoId)}this.uploader.setUploadAuthAndAddress(e,s.uploadAuth,s.uploadAddress,s.imageId||s.videoId)},onUploadSucceed:function(e){},onUploadFailed:function(e,s,a){},onUploadProgress:(e,s,a)=>{e.image||(this.uploadPercent=Math.floor(100*a))},onUploadTokenExpired:function(e){},onUploadEnd:async e=>{this.isUploadSuccess=!0;const{data:s}=await r({lessonId:this.lessonId,coverImageUrl:this.imageUrl,fileId:this.videoId,fileName:this.$refs["video-file"].files[0].name});if("000000"===s.code){const e=setInterval((async()=>{const{data:s}=await n(this.lessonId);"000000"===s.code&&100===s.data&&(this.isTranscodeSuccess=!0,this.$message.success("视频转码成功！"),clearInterval(e))}),1e3)}}})},handleUpload(){this.uploadPercent=0,this.isTranscodeSuccess=!1,this.isUploadSuccess=!1;const e=this.$refs["video-file"].files[0],s=this.$refs["image-file"].files[0];this.uploader.addFile(s),this.uploader.addFile(e),this.uploader.startUpload()}}},c=u,p=a(1001),h=(0,p.Z)(c,t,o,!1,null,"45df6428",null),f=h.exports}}]);
//# sourceMappingURL=course-video.42fe3b71.js.map